{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\AudioMgr.js"],"names":["cc","Class","extends","Component","properties","bgmVolume","sfxVolume","bgmAudioID","hallAudioID","roomAudioID","init","t","sys","localStorage","getItem","parseFloat","game","on","EVENT_HIDE","console","log","audioEngine","pauseAll","EVENT_SHOW","resumeAll","getUrl","url","raw","playBGM","audioUrl","pause","play","resume","setVolume","playSFX","audioId","setSFXVolume","v","setItem","setBGMVolume","force"],"mappings":"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","file":"AudioMgr.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        bgmVolume:1.0,\r\n        sfxVolume:1.0,\r\n        \r\n        bgmAudioID:-1,\r\n        hallAudioID:null,\r\n        roomAudioID:null,\r\n    },\r\n\r\n    // use this for initialization\r\n    init: function () {\r\n        var t = cc.sys.localStorage.getItem(\"bgmVolume\");\r\n        if(t != null){\r\n            this.bgmVolume = parseFloat(t);\r\n        }\r\n        \r\n        var t = cc.sys.localStorage.getItem(\"sfxVolume\");\r\n        if(t != null){\r\n            this.sfxVolume = parseFloat(t);    \r\n        }\r\n        \r\n        cc.game.on(cc.game.EVENT_HIDE, function () {\r\n            console.log(\"cc.audioEngine.pauseAll\");\r\n            cc.audioEngine.pauseAll();\r\n        });\r\n        cc.game.on(cc.game.EVENT_SHOW, function () {\r\n            console.log(\"cc.audioEngine.resumeAll\");\r\n            cc.audioEngine.resumeAll();\r\n        });\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n    \r\n    getUrl:function(url){\r\n        return cc.url.raw(\"resources/sounds/\" + url);\r\n    },\r\n    \r\n    playBGM(url){\r\n        var audioUrl = this.getUrl(url);\r\n        if(url == \"bgFight.mp3\"){\r\n            //�и��ʱ����֮ͣǰ�ĸ�\r\n            if (this.hallAudioID != null) {\r\n                cc.audioEngine.pause(this.hallAudioID);\r\n            }\r\n            //���û�����׸�Ͳ���\r\n            if(this.roomAudioID == null){\r\n                this.roomAudioID = cc.audioEngine.play(audioUrl,true,this.bgmVolume);\r\n            }\r\n            else {\r\n                cc.audioEngine.resume(this.roomAudioID);\r\n            }\r\n            this.bgmAudioID = this.roomAudioID;\r\n        }\r\n        else if(url == \"bgMain.mp3\"){\r\n            if (this.roomAudioID != null) {\r\n                cc.audioEngine.pause(this.roomAudioID);\r\n            }\r\n            if(this.hallAudioID == null){\r\n                this.hallAudioID = cc.audioEngine.play(audioUrl,true,this.bgmVolume);\r\n            }\r\n            else {\r\n                cc.audioEngine.resume(this.hallAudioID);\r\n            }\r\n            this.bgmAudioID = this.hallAudioID;\r\n        }\r\n        cc.audioEngine.setVolume(this.bgmAudioID,this.bgmVolume);\r\n        console.log(audioUrl);\r\n        // if(this.bgmAudioID >= 0){\r\n        //     cc.audioEngine.stop(this.bgmAudioID);\r\n        // }\r\n        // this.bgmAudioID = cc.audioEngine.play(audioUrl,true,this.bgmVolume);\r\n    },\r\n\r\n    pause:function(){\r\n        cc.audioEngine.pause(this.roomAudioID);\r\n    },\r\n\r\n    resume:function(){\r\n        cc.audioEngine.resume(this.roomAudioID);\r\n    },\r\n    \r\n    playSFX(url){\r\n        var audioUrl = this.getUrl(url);\r\n        if(this.sfxVolume > 0){\r\n            var audioId = cc.audioEngine.play(audioUrl,false,this.sfxVolume);    \r\n        }\r\n    },\r\n    \r\n    setSFXVolume:function(v){\r\n        if(this.sfxVolume != v){\r\n            cc.sys.localStorage.setItem(\"sfxVolume\",v);\r\n            this.sfxVolume = v;\r\n        }\r\n    },\r\n    \r\n    setBGMVolume:function(v,force){\r\n        if(this.bgmAudioID >= 0){\r\n            if(v > 0){\r\n                cc.audioEngine.resume(this.bgmAudioID);\r\n            }\r\n            else{\r\n                cc.audioEngine.pause(this.bgmAudioID);\r\n            }\r\n            //cc.audioEngine.setVolume(this.bgmAudioID,this.bgmVolume);\r\n        }\r\n        if(this.bgmVolume != v || force){\r\n            cc.sys.localStorage.setItem(\"bgmVolume\",v);\r\n            this.bgmVolume = v;\r\n            cc.audioEngine.setVolume(this.bgmAudioID,v);\r\n        }\r\n    },\r\n    \r\n    pauseAll:function(){\r\n        cc.audioEngine.pauseAll();\r\n    },\r\n    \r\n    resumeAll:function(){\r\n        cc.audioEngine.resumeAll();\r\n    }\r\n});\r\n"]}