{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\components/assets\\scripts\\components\\AppStart.js"],"names":["urlParse","params","window","location","name","value","str","href","num","indexOf","substr","arr","split","i","length","substring","initMgr","cc","vv","UserMgr","require","userMgr","ReplayMgr","replayMgr","http","global","Net","net","sssNet","sspNet","sssNetMgr","sspNetMgr","Emitter","emitter","AnysdkMgr","anysdkMgr","init","VoiceMgr","voiceMgr","AudioMgr","audioMgr","Utils","utils","isAnalytics","args","Class","extends","Component","properties","label","default","type","Label","loadingProgess","onLoad","sys","isNative","isMobile","cvs","node","getComponent","Canvas","fitHeight","fitWidth","console","log","_mainScene","showSplash","url","raw","loader","load","err","data","VERSION","getServerInfo","bind","onBtnDownloadClicked","openURL","SI","appweb","callback","self","SHOW_TIME","FADE_TIME","_splash","find","os","OS_IOS","active","Sprite","spriteFrame","t","Date","now","fn","dt","setTimeout","op","opacity","onGetVersion","ret","version","director","loadScene","xhr","complete","fnRequest","string","sendRequest","abort","content"],"mappings":"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","file":"AppStart.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["function urlParse(){\r\n    var params = {};\r\n    if(window.location == null){\r\n        return params;\r\n    }\r\n    var name,value; \r\n    var str=window.location.href; //取得整个地址栏\r\n    var num=str.indexOf(\"?\") \r\n    str=str.substr(num+1); //取得所有参数   stringvar.substr(start [, length ]\r\n\r\n    var arr=str.split(\"&\"); //各个参数放到数组里\r\n    for(var i=0;i < arr.length;i++){ \r\n        num=arr[i].indexOf(\"=\"); \r\n        if(num>0){ \r\n            name=arr[i].substring(0,num);\r\n            value=arr[i].substr(num+1);\r\n            params[name]=value;\r\n        } \r\n    }\r\n    return params;\r\n}\r\n\r\nfunction initMgr(){\r\n    cc.vv = {};\r\n    var UserMgr = require(\"UserMgr\");\r\n    cc.vv.userMgr = new UserMgr();\r\n    \r\n    var ReplayMgr = require(\"ReplayMgr\");\r\n    cc.vv.replayMgr = new ReplayMgr();\r\n    \r\n    cc.vv.http = require(\"HTTP\");\r\n    cc.vv.global = require(\"Global\");\r\n    var Net = require(\"Net\");\r\n    cc.vv.net = new Net();\r\n    cc.vv.sssNet = new Net();\r\n    cc.vv.sspNet = new Net();\r\n\r\n    var sssNetMgr = require(\"sssNetMgr\");\r\n    cc.vv.sssNetMgr = new sssNetMgr();\r\n\r\n    var sspNetMgr = require(\"sspNetMgr\");\r\n    cc.vv.sspNetMgr = new sspNetMgr();\r\n\r\n    var Emitter = require(\"emitter\")\r\n    cc.vv.emitter = new Emitter();\r\n    \r\n    var AnysdkMgr = require(\"AnysdkMgr\");\r\n    cc.vv.anysdkMgr = new AnysdkMgr();\r\n    cc.vv.anysdkMgr.init();\r\n    \r\n    var VoiceMgr = require(\"VoiceMgr\");\r\n    cc.vv.voiceMgr = new VoiceMgr();\r\n    cc.vv.voiceMgr.init();\r\n    \r\n    var AudioMgr = require(\"AudioMgr\");\r\n    cc.vv.audioMgr = new AudioMgr();\r\n    cc.vv.audioMgr.init();\r\n    \r\n    var Utils = require(\"Utils\");\r\n    cc.vv.utils = new Utils();\r\n    //var MJUtil = require(\"MJUtil\");\r\n    //cc.vv.mjutil = new MJUtil();\r\n    \r\n    cc.vv.isAnalytics = true;\r\n    \r\n    cc.args = urlParse();\r\n}\r\n    \r\n\r\n    \r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        label: {\r\n            default: null,\r\n            type:cc.Label\r\n        },\r\n\r\n        loadingProgess:cc.Label,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        if(!cc.sys.isNative && cc.sys.isMobile){\r\n            var cvs = this.node.getComponent(cc.Canvas);\r\n            cvs.fitHeight = true;\r\n            cvs.fitWidth = true;\r\n        }\r\n        initMgr();\r\n        console.log('haha'); \r\n        this._mainScene = 'loading';\r\n        this.showSplash(function(){\r\n            var url = cc.url.raw('resources/ver/cv.txt');\r\n            cc.loader.load(url,function(err,data){\r\n                cc.VERSION = data;\r\n                console.log('current core version:' + cc.VERSION);\r\n                this.getServerInfo();\r\n            }.bind(this));\r\n        }.bind(this));\r\n    },\r\n\r\n    onBtnDownloadClicked:function(){\r\n        cc.sys.openURL(cc.vv.SI.appweb);\r\n    },\r\n    \r\n    showSplash:function(callback){\r\n        var self = this;\r\n        var SHOW_TIME = 3000;\r\n        var FADE_TIME = 500;\r\n        this._splash = cc.find(\"Canvas/splash\");\r\n        if(true || cc.sys.os != cc.sys.OS_IOS || !cc.sys.isNative){\r\n            this._splash.active = true;\r\n            if(this._splash.getComponent(cc.Sprite).spriteFrame == null){\r\n                callback();\r\n                return;\r\n            }\r\n            var t = Date.now();\r\n            var fn = function(){\r\n                var dt = Date.now() - t;\r\n                if(dt < SHOW_TIME){\r\n                    setTimeout(fn,33);\r\n                }\r\n                else {\r\n                    var op = (1 - ((dt - SHOW_TIME) / FADE_TIME)) * 255;\r\n                    if(op < 0){\r\n                        self._splash.opacity = 0;\r\n                        callback();   \r\n                    }\r\n                    else{\r\n                        self._splash.opacity = op;\r\n                        setTimeout(fn,33);   \r\n                    }\r\n                }\r\n            };\r\n            setTimeout(fn,33);\r\n        }\r\n        else{\r\n            this._splash.active = false;\r\n            callback();\r\n        }\r\n    },\r\n    \r\n    getServerInfo:function(){\r\n        var self = this;\r\n        var onGetVersion = function(ret){\r\n            if(ret.version == null){\r\n                console.log(\"error.\");\r\n            }\r\n            else{\r\n                cc.vv.SI = ret;\r\n                if(ret.version != cc.VERSION){\r\n                    cc.find(\"Canvas/alert\").active = true;\r\n                }\r\n                else{\r\n                    cc.director.loadScene(self._mainScene);\r\n                }\r\n            }\r\n        };\r\n        \r\n        var xhr = null;\r\n        var complete = false;\r\n        var fnRequest = function(){\r\n            self.loadingProgess.string = \"正在连接服务器\";\r\n            xhr = cc.vv.http.sendRequest(\"/get_serverinfo\",null,function(ret){\r\n                xhr = null;\r\n                complete = true;\r\n                onGetVersion(ret);\r\n            });\r\n            setTimeout(fn,5000);            \r\n        }\r\n        \r\n        var fn = function(){\r\n            if(!complete){\r\n                if(xhr){\r\n                    xhr.abort();\r\n                    self.loadingProgess.string = \"连接失败，即将重试\";\r\n                    setTimeout(function(){\r\n                        fnRequest();\r\n                    },5000);\r\n                }\r\n                else{\r\n                    fnRequest();\r\n                }\r\n            }\r\n        };\r\n        fn();\r\n    },\r\n    log:function(content){\r\n        this.label.string += content + '\\n';\r\n    },\r\n});\r\n"]}