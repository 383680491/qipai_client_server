{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\scripts\\components/assets\\scripts\\components\\LoadingLogic.js"],"names":["cc","Class","extends","Component","properties","tipLabel","Label","_stateStr","_progress","_splash","_isLoading","onLoad","sys","isNative","isMobile","cvs","node","getComponent","Canvas","fitHeight","fitWidth","string","startPreloading","self","loader","onProgress","completedCount","totalCount","item","loadResDir","err","assets","onLoadComplete","director","loadScene","onComplete","update","dt","length","Math","floor","t","Date","now","i"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,kBAASL,GAAGM,KADJ;AAERC,mBAAU,EAFF;AAGRC,mBAAU,GAHF;AAIRC,iBAAQ,IAJA;AAKRC,oBAAW;AALH,KAHP;;AAWL;AACAC,YAAQ,kBAAY;AAChB,YAAG,CAACX,GAAGY,GAAH,CAAOC,QAAR,IAAoBb,GAAGY,GAAH,CAAOE,QAA9B,EAAuC;AACnC,gBAAIC,MAAM,KAAKC,IAAL,CAAUC,YAAV,CAAuBjB,GAAGkB,MAA1B,CAAV;AACAH,gBAAII,SAAJ,GAAgB,IAAhB;AACAJ,gBAAIK,QAAJ,GAAe,IAAf;AACH;AACD,aAAKf,QAAL,CAAcgB,MAAd,GAAuB,KAAKd,SAA5B;AACA,aAAKe,eAAL;AACH,KApBI;;AAsBLA,qBAAgB,2BAAU;AACtB,aAAKf,SAAL,GAAiB,YAAjB;AACA,aAAKG,UAAL,GAAkB,IAAlB;AACA,YAAIa,OAAO,IAAX;;AAEAvB,WAAGwB,MAAH,CAAUC,UAAV,GAAuB,UAAWC,cAAX,EAA2BC,UAA3B,EAAwCC,IAAxC,EAA8C;AACjE;AACA,gBAAGL,KAAKb,UAAR,EAAmB;AACfa,qBAAKf,SAAL,GAAiBkB,iBAAeC,UAAhC;AACH;AACJ,SALD;AAMA3B,WAAGwB,MAAH,CAAUK,UAAV,CAAqB,UAArB,EAAiC,UAAUC,GAAV,EAAeC,MAAf,EAAuB;AACpDR,iBAAKS,cAAL;AACH,SAFD;AAGH,KApCI;;AAsCLA,oBAAe,0BAAU;AACrB,aAAKtB,UAAL,GAAkB,KAAlB;AACA,aAAKH,SAAL,GAAiB,MAAjB;AACAP,WAAGiC,QAAH,CAAYC,SAAZ,CAAsB,OAAtB;AACAlC,WAAGwB,MAAH,CAAUW,UAAV,GAAuB,IAAvB;AACH,KA3CI;;AA6CL;AACAC,YAAQ,gBAAUC,EAAV,EAAc;AAClB,YAAG,KAAK9B,SAAL,CAAe+B,MAAf,IAAyB,CAA5B,EAA8B;AAC1B;AACH;AACD,aAAKjC,QAAL,CAAcgB,MAAd,GAAuB,KAAKd,SAAL,GAAiB,GAAxC;AACA,YAAG,KAAKG,UAAR,EAAmB;AACf,iBAAKL,QAAL,CAAcgB,MAAd,IAAwBkB,KAAKC,KAAL,CAAW,KAAKhC,SAAL,GAAiB,GAA5B,IAAmC,GAA3D;AACH,SAFD,MAGI;AACA,gBAAIiC,IAAIF,KAAKC,KAAL,CAAWE,KAAKC,GAAL,KAAa,IAAxB,IAAgC,CAAxC;AACA,iBAAI,IAAIC,IAAI,CAAZ,EAAeA,IAAIH,CAAnB,EAAsB,EAAGG,CAAzB,EAA2B;AACvB,qBAAKvC,QAAL,CAAcgB,MAAd,IAAwB,GAAxB;AACH;AACJ;AACJ;AA5DI,CAAT","file":"LoadingLogic.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        tipLabel:cc.Label,\r\n        _stateStr:'',\r\n        _progress:0.0,\r\n        _splash:null,\r\n        _isLoading:false,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        if(!cc.sys.isNative && cc.sys.isMobile){\r\n            var cvs = this.node.getComponent(cc.Canvas);\r\n            cvs.fitHeight = true;\r\n            cvs.fitWidth = true;\r\n        }\r\n        this.tipLabel.string = this._stateStr;\r\n        this.startPreloading();\r\n    },\r\n    \r\n    startPreloading:function(){\r\n        this._stateStr = \"正在加载资源，请稍候\"\r\n        this._isLoading = true;\r\n        var self = this;\r\n        \r\n        cc.loader.onProgress = function ( completedCount, totalCount,  item ){\r\n            //console.log(\"completedCount:\" + completedCount + \",totalCount:\" + totalCount );\r\n            if(self._isLoading){\r\n                self._progress = completedCount/totalCount;\r\n            }\r\n        };\r\n        cc.loader.loadResDir(\"textures\", function (err, assets) {\r\n            self.onLoadComplete();\r\n        });      \r\n    },\r\n    \r\n    onLoadComplete:function(){\r\n        this._isLoading = false;\r\n        this._stateStr = \"准备登陆\";\r\n        cc.director.loadScene(\"login\");\r\n        cc.loader.onComplete = null;\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    update: function (dt) {\r\n        if(this._stateStr.length == 0){\r\n            return;\r\n        }\r\n        this.tipLabel.string = this._stateStr + ' ';\r\n        if(this._isLoading){\r\n            this.tipLabel.string += Math.floor(this._progress * 100) + \"%\";   \r\n        }\r\n        else{\r\n            var t = Math.floor(Date.now() / 1000) % 4;\r\n            for(var i = 0; i < t; ++ i){\r\n                this.tipLabel.string += '.';\r\n            }            \r\n        }\r\n    }\r\n});"]}