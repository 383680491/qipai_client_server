{"version":3,"sources":["sspRoom.js"],"names":["cc","Class","extends","Component","properties","lblRoomNo","default","type","Label","_seats","_seats2","_timeLabel","_voiceMsgQueue","_lastPlayingSeat","_playingSeat","_lastPlayTime","_yaoqingma","_time","_min","_second","_isExit","onLoad","vv","initView","initSeats","initEventHandlers","prepare","node","getChildByName","seats","i","children","length","push","getComponent","initBtnMgr","refreshBtns","find","string","sspNetMgr","roomId","gameChild","sides","sideNode","seat","conf","seatIndex","numOfGames","yaoqing","notice","active","btnWechat","userMgr","control","value","sys","os","OS_IOS","btnReady","btnWeichat","utils","addClickEvent","btnDissolve","isIdle","maxNumOfGames","isPlaying","isOwner","setBtnReadyActive","bActive","self","on","data","userid","initSingleSeat","resetSeats","refreshXuanPaiState","detail","playVoice","idx","getSeatIndexByID","sender","tempIdx","getLocalIndexByIndex","localIdx","getShowIndexByIndex","index","chat","content","info","getQuickChatInfo","index1","audioMgr","playSFX","sound","pai","setDipai","yinlong_dipai","star","mySch","Animation","window","sspGame","setPosition","j","userId","xingxing","play","setStar","scheduleOnce","score","_userId","setScore","emoji","console","log","min","sec","t","Math","ceil","floor","sspNet","send","len","dipai","sprite","Sprite","spriteFrame","SSPMgr","getSpriteFrameByPai","seatindex","isOffline","online","isZhuang","button","setInfo","name","setReady","ready","setOffline","setID","voiceMsg","gamestate","tempIndex","showIndex","isIndex","isNaN","setZhuang","onBtnSettingsClicked","popupMgr","showSettings","onBtnDissolveClicked","alert","show","onBtnWeichatClicked","browserType","anysdkMgr","getAccess_token","OS_ANDROID","agent","anysdk","agentManager","share_plugin","getSharePlugin","setListener","onShareResult","shareUrl","onBtnExit","shift","localIndex","msgInfo","JSON","parse","msgfile","String","dataIndex","msg","voiceMgr","writeVoice","Date","now","time","update","dt","minutes","_lastMinute","date","h","getHours","m","getMinutes","onPlayerOver","resume","code","ShareResultCode","kShareSuccess","kShareFail","kShareCancel","kShareNetworkError","title","text","url","imagePath","to","map","mediaType","shareTo","thumbSize","share","reset","onDestroy","stop","clear"],"mappings":"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","file":"sspRoom.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\sspgame","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        lblRoomNo:{\r\n            default:null,\r\n            type:cc.Label\r\n        },\r\n        _seats:[],\r\n        _seats2:[],\r\n        _timeLabel:null,\r\n        _voiceMsgQueue:[],\r\n        _lastPlayingSeat:null,\r\n        _playingSeat:null,\r\n        _lastPlayTime:null,\r\n        _yaoqingma:null,\r\n        _time:null,\r\n        _min:null,\r\n        _second:null,\r\n        _isExit:null,\r\n    },\r\n\r\n    onLoad: function () {\r\n        if(cc.vv == null){\r\n            return;\r\n        }\r\n        \r\n        this.initView();\r\n        this.initSeats();\r\n        this.initEventHandlers();\r\n    },\r\n    \r\n    initView:function(){\r\n        this.prepare = this.node.getChildByName(\"prepare\");\r\n        var seats = this.prepare.getChildByName(\"seats\");\r\n        for(var i = 0; i < seats.children.length; ++i){\r\n            this._seats.push(seats.children[i].getComponent(\"sspSeat\"));\r\n        }\r\n        this.initBtnMgr();\r\n        this.refreshBtns();\r\n        \r\n        this._time = 60;\r\n        this._isExit = 0;\r\n        this._min = cc.find(\"Canvas/prepare/notice/minute\").getComponent(cc.Label);\r\n        this._second = cc.find(\"Canvas/prepare/notice/second\").getComponent(cc.Label);\r\n        this.lblRoomNo = cc.find(\"Canvas/infobar/Z_room_txt/New Label\").getComponent(cc.Label);\r\n        this._yaoqingma = cc.find(\"Canvas/prepare/yaoqing/New Label\").getComponent(cc.Label);\r\n        this._timeLabel = cc.find(\"Canvas/infobar/time\").getComponent(cc.Label);\r\n        this.lblRoomNo.string = cc.vv.sspNetMgr.roomId;\r\n        this._yaoqingma.string = \"邀请码：\" + cc.vv.sspNetMgr.roomId;\r\n        var gameChild = this.node.getChildByName(\"game\");\r\n        var sides = [\"myself\",\"right\",\"up\",\"left\"];\r\n        for(var i = 0; i < sides.length; ++i){\r\n            var sideNode = gameChild.getChildByName(sides[i]);\r\n            var seat = sideNode.getChildByName(\"seat\");\r\n            this._seats2.push(seat.getComponent(\"sspGameSeat\"));\r\n        }\r\n        \r\n        if(cc.vv.sspNetMgr.conf){\r\n            var type = cc.vv.sspNetMgr.conf.type;\r\n            if(type == null || type == \"\"){\r\n                type = \"xzdd\";\r\n            }\r\n        }\r\n\r\n        var seatIndex = cc.vv.sspNetMgr.seatIndex;\r\n\r\n        //隐藏邀请码\r\n        if (cc.vv.sspNetMgr.numOfGames > 0) {\r\n            let yaoqing = cc.find(\"Canvas/prepare/yaoqing\");\r\n            let notice = cc.find(\"Canvas/prepare/notice\");\r\n            yaoqing.active = false;\r\n            notice.active = false;\r\n        }\r\n        var seatIndex = cc.vv.sspNetMgr.seatIndex;\r\n        var btnWechat = cc.find(\"Canvas/prepare/btnWeichat\");\r\n        if(cc.vv.userMgr.control.value != 1 && cc.sys.os == cc.sys.OS_IOS){ //苹果隐藏\r\n            btnWechat.active = false;\r\n            cc.find(\"Canvas/game_result/btnShare\").active = false;\r\n            cc.find(\"Canvas/userinfo/diamond\").active = false;\r\n            cc.find(\"Canvas/userinfo/money\").active = false;\r\n        }\r\n    },\r\n\r\n    //初始化按钮\r\n    initBtnMgr:function(){\r\n        this.btnReady = this.prepare.getChildByName(\"btnReady\");\r\n        this.btnWeichat = this.prepare.getChildByName(\"btnWeichat\");\r\n        if(this.btnWeichat){\r\n            if(cc.vv.userMgr.control.value == 0){\r\n                this.btnWeichat.active = false;\r\n            }\r\n            cc.vv.utils.addClickEvent(this.btnWeichat,this.node,\"sspRoom\",\"onBtnWeichatClicked\");\r\n        }\r\n        this.btnDissolve = this.prepare.getChildByName(\"btnDissolve\");\r\n    },\r\n\r\n    refreshBtns:function(){\r\n        this.btnReady = this.prepare.getChildByName(\"btnReady\");\r\n        this.btnDissolve = this.prepare.getChildByName(\"btnDissolve\");\r\n        this.btnWeichat = this.prepare.getChildByName(\"btnWeichat\");\r\n        var isIdle = cc.vv.sspNetMgr.numOfGames <= cc.vv.sspNetMgr.maxNumOfGames;\r\n        var isPlaying = cc.vv.sspNetMgr.numOfGames > 0;\r\n        \r\n        this.btnDissolve.active = cc.vv.sspNetMgr.isOwner() && !isPlaying;\r\n        this.btnWeichat.active = isIdle;\r\n        this.btnReady.active = isIdle;\r\n        if(cc.vv.userMgr.control.value == 0){\r\n            this.btnWeichat.active = false;\r\n        }\r\n    },\r\n    \r\n    //准备界面邀请、准备等按钮显示\r\n    setBtnReadyActive:function(bActive){\r\n        this.btnReady.active = bActive;\r\n        this.btnWeichat.active = bActive;\r\n        if(cc.vv.userMgr.control.value == 0){\r\n            this.btnWeichat.active = false;\r\n        }\r\n    },\r\n\r\n    initEventHandlers:function(){\r\n        var self = this;\r\n        this.node.on('new_user',function(data){\r\n            var seats = cc.vv.sspNetMgr.seats;\r\n            for(var i = 0; i < seats.length; ++i){\r\n                if(seats[i].userid > 0){\r\n                    self.initSingleSeat(seats[i]);\r\n                }\r\n            }\r\n        });\r\n        \r\n        this.node.on('user_state_changed',function(data){\r\n            var seats = cc.vv.sspNetMgr.seats;\r\n            for(var i = 0; i < seats.length; ++i){\r\n                if(seats[i].userid > 0){\r\n                    self.initSingleSeat(seats[i]);\r\n                }\r\n            }\r\n        });\r\n        \r\n        this.node.on('game_begin',function(data){\r\n            self.refreshBtns();\r\n            self.initSeats();\r\n        });\r\n\r\n        this.node.on('resetSeats',function(data){\r\n            self.refreshBtns();\r\n            self.resetSeats();\r\n        });\r\n        \r\n        this.node.on('game_num',function(data){\r\n            self.refreshBtns();\r\n        });\r\n\r\n        this.node.on('game_huanpai',function(data){\r\n            for(var i in self._seats2){\r\n                self._seats2[i].refreshXuanPaiState();    \r\n            }\r\n        });\r\n        \r\n        this.node.on('game_huanpai_over',function(data){\r\n            for(var i in self._seats2){\r\n                self._seats2[i].refreshXuanPaiState();    \r\n            }\r\n        });\r\n        \r\n        this.node.on('voice_msg',function(data){\r\n            var data = data.detail;\r\n            self._voiceMsgQueue.push(data);\r\n            self.playVoice();\r\n        });\r\n        \r\n        this.node.on('chat_push',function(data){\r\n            var data = data.detail;\r\n            var idx = cc.vv.sspNetMgr.getSeatIndexByID(data.sender);\r\n            var tempIdx = cc.vv.sspNetMgr.getLocalIndexByIndex(idx);\r\n            var localIdx = cc.vv.sspNetMgr.getShowIndexByIndex(tempIdx);\r\n            if (self.node.getChildByName(\"game\").active === false) {  //游戏未开始\r\n                var index = tempIdx;\r\n                self._seats[index].chat(data.content);\r\n            }\r\n            else{\r\n                var index = localIdx;\r\n                self._seats2[index].chat(data.content);\r\n            }\r\n        });\r\n        \r\n        this.node.on('quick_chat_push',function(data){\r\n            var data = data.detail;\r\n            var idx = cc.vv.sspNetMgr.getSeatIndexByID(data.sender);\r\n            var tempIdx = cc.vv.sspNetMgr.getLocalIndexByIndex(idx);\r\n            var localIdx = cc.vv.sspNetMgr.getShowIndexByIndex(tempIdx);\r\n\r\n            var index = data.content;\r\n            var info = cc.vv.chat.getQuickChatInfo(index);\r\n            if (self.node.getChildByName(\"game\").active === false) {  //游戏未开始\r\n                var index1 = tempIdx;\r\n                self._seats[index1].chat(info.content);\r\n            }\r\n            else{\r\n                var index1 = localIdx;\r\n                self._seats2[index1].chat(info.content);\r\n            }\r\n            \r\n            cc.vv.audioMgr.playSFX(info.sound);\r\n        });\r\n\r\n        this.node.on('game_dipai_notify', function(pai){\r\n            var pai = pai.detail;\r\n            self.setDipai(pai);\r\n        });\r\n\r\n        this.node.on('5yinlong_dipai_notify', function(pai){\r\n            var pai = pai.detail;\r\n            self.yinlong_dipai(pai);\r\n        });\r\n\r\n        this.node.on('game_star_notify', function(star){  //星星个数\r\n            var star = star.detail;\r\n            var mySch =function(){ \r\n                var Animation = window.sspGame.Animation;\r\n                Animation.node.setPosition(0,0);\r\n                for(var j = 0;j < star.length;j++){\r\n                    if(star[j].star > 0){\r\n                        var idx = cc.vv.sspNetMgr.getSeatIndexByID(star[j].userId);\r\n                        var tempIdx = cc.vv.sspNetMgr.getLocalIndexByIndex(idx);\r\n                        var localIdx = cc.vv.sspNetMgr.getShowIndexByIndex(tempIdx);\r\n                        var xingxing = Animation.xingxing[localIdx];\r\n                        xingxing.active = true;\r\n                        xingxing.getComponent(cc.Animation).play('xingxing');\r\n                        self._seats2[localIdx].setStar(star[j].star); \r\n                    }\r\n                }   \r\n            }\r\n            self.scheduleOnce(mySch,1.0);\r\n            \r\n        });\r\n\r\n        this.node.on('score_notify',function(data){ //分数\r\n            var score = data.detail.score;\r\n            for(var i in self._seats2){\r\n                for(var j = 0;j < score.length;j++){\r\n                    if(self._seats2[i]._userId === score[j].userId){\r\n                        self._seats2[i].setScore(score[j].score); \r\n                    }\r\n                }   \r\n            }\r\n        });\r\n\r\n        this.node.on('emoji_push',function(data){\r\n            var data = data.detail;\r\n            var idx = cc.vv.sspNetMgr.getSeatIndexByID(data.sender);\r\n            var tempIdx = cc.vv.sspNetMgr.getLocalIndexByIndex(idx);\r\n            var localIdx = cc.vv.sspNetMgr.getShowIndexByIndex(tempIdx);\r\n            if (self.node.getChildByName(\"game\").active === false) {  //游戏未开始\r\n                var index = tempIdx;\r\n                self._seats[index].emoji(data.content);\r\n            }\r\n            else{\r\n                var index = localIdx;\r\n                self._seats2[index].emoji(data.content);\r\n            }\r\n            console.log(data);\r\n        });\r\n\r\n        this.node.on('set_dissolutionTime',function(data){ //设置剩余 自动解散房间 的时间\r\n            var data = data.detail;\r\n            self._time= data / 1000;\r\n            if(self._time > 0){\r\n                var min = null;\r\n                var sec = null;\r\n                var t = Math.ceil(self._time);\r\n                min = Math.floor(t / 60);\r\n                sec = Math.floor(t % 60);\r\n                self._min.string = min;\r\n                self._second.string = sec;\r\n                \r\n            }\r\n            else if (self._time <=0) {\r\n                self._isExit++;\r\n                if (self._isExit === 1) {\r\n                    cc.vv.sspNet.send(\"dispress\");\r\n                }\r\n            }\r\n        });        \r\n        this.node.on('user_state_changed',function(data){\r\n            var userid = data.detail.userid;\r\n            if (cc.vv.userMgr.userId === userid) {\r\n                self.setBtnReadyActive(false);\r\n            }\r\n        });\r\n\r\n        this.node.on('user_ready_changed',function(data){\r\n            var userid = data.detail;\r\n            if (cc.vv.userMgr.userId === userid) {\r\n                self.setBtnReadyActive(false);\r\n            }\r\n        });\r\n    },\r\n\r\n    initSeats:function(){\r\n        var seats = cc.vv.sspNetMgr.seats;\r\n        var len = 0;\r\n        for (let j = 0; j < seats.length; ++j) {\r\n            if (seats[j].userid > 0) {\r\n                len++;\r\n            }\r\n        }\r\n        for(var i = 0; i < len; ++i){\r\n            this.initSingleSeat(seats[i]);\r\n        }\r\n    },\r\n\r\n    setDipai:function(pai){\r\n        var dipai = cc.find(\"Canvas/game/dipai\");\r\n        dipai.active = false;\r\n        var sprite = cc.find(\"Canvas/game/arrow/pai\").getComponent(cc.Sprite);\r\n        sprite.spriteFrame = cc.vv.SSPMgr.getSpriteFrameByPai(\"M_\",pai);\r\n    },\r\n\r\n    yinlong_dipai:function(pai){\r\n        var dipai = cc.find(\"Canvas/game/dipai\");\r\n        dipai.active = true;\r\n\r\n        for (var i = 0; i < dipai.children.length; i++) {\r\n            var sprite = dipai.children[i].getComponent(cc.Sprite);\r\n            sprite.spriteFrame = cc.vv.SSPMgr.getSpriteFrameByPai(\"M_\",pai[i]);\r\n        }\r\n    },\r\n    \r\n    initSingleSeat:function(seat){\r\n        var index = cc.vv.sspNetMgr.getLocalIndexByIndex(seat.seatindex,false);\r\n        if(index === null){\r\n            return;\r\n        }\r\n        var isOffline = !seat.online;\r\n        var isZhuang = seat.seatindex == cc.vv.sspNetMgr.button;\r\n        \r\n        console.log(\"isOffline:\" + isOffline);\r\n        this._seats[index].active = true;\r\n        this._seats[index].setInfo(seat.name,seat.score);\r\n        this._seats[index].setReady(seat.ready);\r\n        this._seats[index].setOffline(isOffline);\r\n        this._seats[index].setID(seat.userid);\r\n        this._seats[index].voiceMsg(false);\r\n\r\n        if (!cc.vv.sspNetMgr.gamestate) {\r\n            return;\r\n        }\r\n        var tempIndex = cc.vv.sspNetMgr.getLocalIndexByIndex(seat.seatindex);\r\n        var showIndex = cc.vv.sspNetMgr.getShowIndexByIndex(tempIndex);\r\n        var isIndex = isNaN(showIndex);\r\n        \r\n        if(seat.star){\r\n            this._seats2[showIndex].setStar(seat.star);\r\n        }\r\n        \r\n        this._seats2[showIndex].setInfo(seat.name,seat.score);\r\n        this._seats2[showIndex].setZhuang(isZhuang);\r\n        this._seats2[showIndex].setOffline(isOffline);\r\n        this._seats2[showIndex].setID(seat.userid);\r\n        this._seats2[showIndex].voiceMsg(false);\r\n        this._seats2[showIndex].refreshXuanPaiState();\r\n    },\r\n\r\n    onBtnSettingsClicked:function(){\r\n        cc.vv.popupMgr.showSettings();   \r\n    },\r\n    \r\n    onBtnDissolveClicked:function(){\r\n        cc.vv.alert.show(\"解散房间\",\"解散房间不扣房卡，是否确定解散？\",function(){\r\n            cc.vv.sspNet.send(\"dispress\");    \r\n        },true);\r\n    },\r\n\r\n    onBtnWeichatClicked:function(){\r\n        //微信分享监听\r\n        console.log('分享房间号至微信: ');\r\n        //微信浏览器----公众号登录 \r\n        if(cc.sys.browserType == \"mqqbrowser\" || \"wechat\" == cc.sys.browserType){\r\n            console.log(\"H5分享好友\");\r\n            cc.find(\"Canvas/WebShare\").active = true;\r\n            cc.vv.anysdkMgr.getAccess_token(\"小伙子，我在四色牌【\"+cc.vv.sspNetMgr.roomId+\"】开好了房间，快来大战三百回合\",cc.vv.sspNetMgr.roomId);\r\n        }\r\n        else if(cc.sys.os == cc.sys.OS_ANDROID || cc.sys.os == cc.sys.OS_IOS){\r\n            var agent = anysdk.agentManager;\r\n            this.share_plugin = agent.getSharePlugin();\r\n            this.share_plugin.setListener(this.onShareResult, this);\r\n            this.shareUrl(\"斗斗福建十三水\",\"小伙子，我在四色牌【\"+cc.vv.sspNetMgr.roomId+\"】开好了房间，快来大战三百回合\",\r\n            \"http://game.doudouyule.wang/?roomId=\"+cc.vv.sspNetMgr.roomId,\r\n            \"http://game.doudouyule.wang/icon.png\",\"0\");//标题 内容 URL 图片路径 发送至\r\n        }\r\n        //其它浏览器----二维码扫码登录 \r\n        else{\r\n            console.log(\"H5分享好友\");\r\n            cc.find(\"Canvas/WebShare\").active = true;\r\n            cc.vv.anysdkMgr.getAccess_token(\"小伙子，我在四色牌【\"+cc.vv.sspNetMgr.roomId+\"】开好了房间，快来大战三百回合\",cc.vv.sspNetMgr.roomId);\r\n        }\r\n    },\r\n    \r\n    onBtnExit:function(){\r\n        cc.vv.sspNet.send(\"exit\");\r\n    },\r\n    \r\n    playVoice:function(){\r\n        if(this._playingSeat == null && this._voiceMsgQueue.length){\r\n            console.log(\"playVoice2\");\r\n            var data = this._voiceMsgQueue.shift();\r\n            var idx = cc.vv.sspNetMgr.getSeatIndexByID(data.sender);\r\n            var localIndex = cc.vv.sspNetMgr.getShowIndexByIndex(idx);\r\n            this._playingSeat = localIndex;\r\n            this._seats[localIndex].voiceMsg(true);\r\n            this._seats2[localIndex].voiceMsg(true);\r\n            \r\n            var msgInfo = JSON.parse(data.content);\r\n            var msgfile = \"voicemsg\" + String(this.dataIndex) + \".amr\";\r\n            console.log(msgInfo.msg.length);\r\n            cc.vv.voiceMgr.writeVoice(msgfile,msgInfo.msg);\r\n            cc.vv.voiceMgr.play(msgfile);\r\n            this._lastPlayTime = Date.now() + msgInfo.time;\r\n        }\r\n    },\r\n    \r\n    update: function (dt) {\r\n        var minutes = Math.floor(Date.now()/1000/60);\r\n        if(this._lastMinute != minutes){\r\n            this._lastMinute = minutes;\r\n            var date = new Date();\r\n            var h = date.getHours();\r\n            h = h < 10? \"0\"+h:h;\r\n            \r\n            var m = date.getMinutes();\r\n            m = m < 10? \"0\"+m:m;\r\n            this._timeLabel.string = \"\" + h + \":\" + m;             \r\n        }\r\n        \r\n        \r\n        if(this._lastPlayTime != null){\r\n            if(Date.now() > this._lastPlayTime + 200){\r\n                this.onPlayerOver();\r\n                this._lastPlayTime = null;    \r\n            }\r\n        }\r\n        else{\r\n            this.playVoice();\r\n        }\r\n    },\r\n    \r\n        \r\n    onPlayerOver:function(){\r\n        cc.vv.audioMgr.resume();\r\n        console.log(\"onPlayCallback:\" + this._playingSeat);\r\n        var localIndex = this._playingSeat;\r\n        this._playingSeat = null;\r\n        this._seats[localIndex].voiceMsg(false);\r\n        this._seats2[localIndex].voiceMsg(false);\r\n    },\r\n\r\n    //分享事件\r\n    onShareResult:function(code, msg){\r\n        console.log('111111111111111111111111111111111111');\r\n    console.log(\"share result, resultcode:\"+code+\", msg: \"+msg);\r\n    switch ( code ) {\r\n        case anysdk.ShareResultCode.kShareSuccess:\r\n            console.log('分享成功');\r\n            break;\r\n        case anysdk.ShareResultCode.kShareFail:\r\n            console.log('分享失败');\r\n            break;\r\n        case anysdk.ShareResultCode.kShareCancel:\r\n            console.log('分享取消');\r\n            break;\r\n        case anysdk.ShareResultCode.kShareNetworkError:\r\n            console.log('分享错误');\r\n            break;\r\n        }\r\n    },\r\n    //分享URL\r\n    shareUrl:function(title,text,url,imagePath,to){\r\n        console.log('分享URL: ');\r\n        console.log('title: ' + title);\r\n        console.log('text: ' + text);\r\n        console.log('url: ' + url);\r\n        console.log('imagePath: ' + imagePath);\r\n        console.log('to: ' + to);\r\n        var map ={\r\n            title : title,//标题\r\n            text  : text,//文本\r\n            url   : url,//链接\r\n            mediaType : '2',//分享类型\r\n            shareTo : to,//分享至 0 聊天 1 朋友圈 2 收藏\r\n            imagePath : imagePath,//图片路径\r\n            thumbSize : '64'\r\n        }\r\n        this.share_plugin.share(map);\r\n    },\r\n\r\n    resetSeats:function(){\r\n        var seats = cc.vv.sspNetMgr.seats;\r\n        for(var i = 0; i < seats.length; ++i){\r\n            this._seats[i].reset();\r\n            this._seats2[i].reset();\r\n        }\r\n        this.initSeats();\r\n    },\r\n\r\n    \r\n    onDestroy:function(){\r\n        cc.vv.voiceMgr.stop();\r\n        if(cc.vv){\r\n            cc.vv.sspNetMgr.clear();   \r\n        }\r\n    }\r\n});\r\n"]}