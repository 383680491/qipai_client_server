{"version":3,"sources":["UserInfoShow.js"],"names":["cc","Class","extends","Component","properties","_userinfo","onLoad","vv","find","active","_money","moneyInfo","getComponent","utils","addClickEvent","node","userinfoShow","_userId","initView","self","onGet","ret","errcode","console","log","errmsg","gems","string","data","account","userMgr","sign","http","sendRequest","bind","show","name","userId","iconSprite","sex","ip","getChildByName","Sprite","spriteFrame","str","len","length","substring","Label","onClicked"],"mappings":"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","file":"UserInfoShow.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        _userinfo:null,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        if(cc.vv == null){\r\n            return;\r\n        }\r\n        \r\n        this._userinfo = cc.find(\"Canvas/userinfo\");\r\n        this._userinfo.active = false;\r\n        this._money = cc.find(\"Canvas/userinfo/money\");\r\n        this.moneyInfo = this._money.getComponent('cc.Label');\r\n        cc.vv.utils.addClickEvent(this._userinfo,this.node,\"UserInfoShow\",\"onClicked\");\r\n        \r\n        cc.vv.userinfoShow = this;\r\n        this._userId = null;\r\n        this.initView();\r\n    },\r\n    \r\n    initView:function() {\r\n        var self = this;\r\n        var onGet = function(ret){\r\n            if(ret.errcode !== 0){\r\n                console.log(ret.errmsg);\r\n            }\r\n            else{\r\n                if(ret.gems != null){\r\n                    this.moneyInfo.string = ret.gems;    \r\n                }\r\n            }\r\n        };\r\n        \r\n        var data = {\r\n            account:cc.vv.userMgr.account,\r\n            sign:cc.vv.userMgr.sign,\r\n        };\r\n        cc.vv.http.sendRequest(\"/get_user_status\",data,onGet.bind(this));\r\n    },\r\n\r\n    show:function(name,userId,iconSprite,sex,ip){\r\n        if(userId != null && userId > 0){\r\n            this._userinfo.active = true;\r\n            this._userinfo.getChildByName(\"icon\").getComponent(cc.Sprite).spriteFrame = iconSprite.spriteFrame;\r\n            var str = null;\r\n            if (name) {\r\n                var len = name.length;\r\n                if (len > 4) {\r\n                    str = name.substring(0,4) + '...';\r\n                }\r\n                else {\r\n                    str = name;\r\n                }\r\n            }\r\n            this._userinfo.getChildByName(\"name\").getComponent(cc.Label).string = str;\r\n            //this._userinfo.getChildByName(\"ip\").getComponent(cc.Label).string = \"IP: \" + ip.replace(\"::ffff:\",\"\");\r\n            this._userinfo.getChildByName(\"id\").getComponent(cc.Label).string = \"ID: \" + userId;\r\n            this._userId = userId;\r\n            // var sex_female = this._userinfo.getChildByName(\"sex_female\");\r\n            // sex_female.active = false;\r\n            \r\n            // var sex_male = this._userinfo.getChildByName(\"sex_male\");\r\n            // sex_male.active = false;\r\n            var sex = this._userinfo.getChildByName(\"sex\");\r\n            var sex = cc.vv.userMgr.sex;\r\n            if(sex == 1){\r\n                sex.getComponent(cc.Label).string = \"性别：男\";\r\n            }   \r\n            else if(sex == 2){\r\n                sex.getComponent(cc.Label).string = \"性别：女\";\r\n            }\r\n        }\r\n    },\r\n    \r\n    onClicked:function(){\r\n        this._userinfo.active = false;\r\n    }\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}