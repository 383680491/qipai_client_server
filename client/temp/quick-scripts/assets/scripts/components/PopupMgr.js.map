{"version":3,"sources":["PopupMgr.js"],"names":["cc","Class","extends","Component","properties","_popuproot","_settings","_dissolveNotice","_endTime","_extraInfo","_noticeLabel","_noticePlayerLabel","onLoad","vv","popupMgr","find","active","getChildByName","getComponent","Label","closeAll","addBtnHandler","self","gameType","userMgr","serverType","emitter","on","dissolveNotice","bind","dissolveCancel","removeHandler","stopEndTime","node","event","data","detail","showDissolveNotice","off","start","sssNetMgr","dissoveData","sspNetMgr","btnName","btn","addClickEvent","target","component","handler","eventHandler","EventHandler","clickEvents","Button","push","onBtnClicked","name","sssNet","send","isObserver","sspNet","showSettings","showDissolveRequest","replayMgr","isReplay","Date","now","time","i","states","length","b","seats","len","substring","update","dt","lastTime","m","Math","floor","s","ceil","str","string"],"mappings":"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","file":"PopupMgr.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        _popuproot:null,\r\n        _settings:null,\r\n        _dissolveNotice:null,\r\n        \r\n        _endTime:-1,\r\n        _extraInfo:null,\r\n        _noticeLabel:null,\r\n        _noticePlayerLabel:null,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        if(cc.vv == null){\r\n            return;\r\n        }\r\n        \r\n        cc.vv.popupMgr = this;\r\n        \r\n        this._popuproot = cc.find(\"Canvas/popups\");\r\n        this._popuproot.active = false;\r\n        this._settings = cc.find(\"Canvas/popups/settings\");\r\n        this._dissolveNotice = cc.find(\"Canvas/popups/dissolve_notice\");\r\n        this._noticeLabel = this._dissolveNotice.getChildByName(\"info0\").getComponent(cc.Label);\r\n        this._noticePlayerLabel = this._dissolveNotice.getChildByName(\"info\").getComponent(cc.Label);\r\n        \r\n        this.closeAll();\r\n        \r\n        this.addBtnHandler(\"settings/btn_close\");\r\n        this.addBtnHandler(\"settings/btn_sqjsfj\");\r\n        this.addBtnHandler(\"dissolve_notice/btn_agree\");\r\n        this.addBtnHandler(\"dissolve_notice/btn_reject\");\r\n        //this.addBtnHandler(\"dissolve_notice/btn_ok\");\r\n        \r\n        var self = this;\r\n        var gameType = cc.vv.userMgr.serverType;\r\n        if('SSS_SERVER_TYPE' === gameType){\r\n\r\n            cc.vv.emitter.on('dissolve_notice', this.dissolveNotice.bind(this));\r\n            cc.vv.emitter.on('dissolve_cancel', this.dissolveCancel.bind(this));\r\n            cc.vv.emitter.on('remove_handler', this.removeHandler.bind(this));\r\n            cc.vv.emitter.on('stopEndTime', this.stopEndTime.bind(this));\r\n        }\r\n        \r\n        this.node.on(\"dissolve_notice\",function(event){\r\n            var data = event.detail;\r\n            self.showDissolveNotice(data);\r\n        });\r\n        \r\n        this.node.on(\"dissolve_cancel\",function(event){\r\n            self.closeAll();\r\n        });\r\n    },\r\n\r\n    removeHandler:function(){\r\n        cc.vv.emitter.off('dissolve_notice');\r\n        cc.vv.emitter.off('dissolve_cancel');\r\n        cc.vv.emitter.off('remove_handler');\r\n    },\r\n\r\n    dissolveNotice:function(data){\r\n        this.showDissolveNotice(data);\r\n    },\r\n\r\n    dissolveCancel:function(){\r\n        this.closeAll();\r\n    },\r\n\r\n    start:function(){\r\n        var gameType = cc.vv.userMgr.serverType;\r\n        if(cc.vv.sssNetMgr.dissoveData) {\r\n            if('SSS_SERVER_TYPE' === gameType){\r\n                this.showDissolveNotice(cc.vv.sssNetMgr.dissoveData);\r\n            }\r\n        }\r\n        else if(cc.vv.sspNetMgr.dissoveData) {\r\n            if('SSP_SERVER_TYPE' === gameType){\r\n                this.showDissolveNotice(cc.vv.sspNetMgr.dissoveData);\r\n            }\r\n        }\r\n    },\r\n    \r\n    addBtnHandler:function(btnName){\r\n        var btn = cc.find(\"Canvas/popups/\" + btnName);\r\n        this.addClickEvent(btn,this.node,\"PopupMgr\",\"onBtnClicked\");\r\n    },\r\n    \r\n    addClickEvent:function(node,target,component,handler){\r\n        var eventHandler = new cc.Component.EventHandler();\r\n        eventHandler.target = target;\r\n        eventHandler.component = component;\r\n        eventHandler.handler = handler;\r\n\r\n        var clickEvents = node.getComponent(cc.Button).clickEvents;\r\n        clickEvents.push(eventHandler);\r\n    },\r\n\r\n    stopEndTime:function(){\r\n        this._endTime = 0;\r\n    },\r\n    \r\n    onBtnClicked:function(event){\r\n        this.closeAll();\r\n        var gameType = cc.vv.userMgr.serverType;\r\n        var btnName = event.target.name;\r\n\r\n        if('SSS_SERVER_TYPE' === gameType){\r\n            if(btnName == \"btn_agree\"){\r\n                cc.vv.sssNet.send(\"dissolve_agree\");\r\n            }\r\n            else if(btnName == \"btn_reject\"){\r\n                cc.vv.sssNet.send(\"dissolve_reject\");\r\n            }\r\n            else if(btnName == \"btn_sqjsfj\"){\r\n                cc.vv.sssNet.send(\"dissolve_request\"); \r\n            }\r\n        }\r\n        else if('SSP_SERVER_TYPE' === gameType){\r\n            if (cc.vv.sspNetMgr.isObserver) {\r\n                return;\r\n            }\r\n            if(btnName == \"btn_agree\"){\r\n                cc.vv.sspNet.send(\"dissolve_agree\");\r\n            }\r\n            else if(btnName == \"btn_reject\"){\r\n                cc.vv.sspNet.send(\"dissolve_reject\");\r\n            }\r\n            else if(btnName == \"btn_sqjsfj\"){\r\n                cc.vv.sspNet.send(\"dissolve_request\"); \r\n            }\r\n        }    \r\n    },\r\n    \r\n    closeAll:function(){\r\n        if(this._popuproot){\r\n            this._popuproot.active = false;\r\n            this._settings.active = false;\r\n            this._dissolveNotice.active = false;\r\n        }\r\n    },\r\n    \r\n    showSettings:function(){\r\n        if(this._popuproot){\r\n            this.closeAll();\r\n            this._popuproot.active = true;\r\n            this._settings.active = true;\r\n        }\r\n    },\r\n    \r\n    showDissolveRequest:function(){\r\n        this.closeAll();\r\n        this._popuproot.active = true;\r\n    },\r\n    \r\n    showDissolveNotice:function(data){\r\n        if (cc.vv.replayMgr.isReplay()) {\r\n            return;\r\n        }\r\n        var gameType = cc.vv.userMgr.serverType;\r\n        this._endTime = Date.now()/1000 + data.time;\r\n        this._extraInfo = \"\";\r\n        for(var i = 0; i < data.states.length; ++i){\r\n            var b = data.states[i];\r\n            var name = '';\r\n            if('SSS_SERVER_TYPE' === gameType){\r\n                name = cc.vv.sssNetMgr.seats[i].name;\r\n                var len = name.length;\r\n                if (len > 4) {\r\n                    name = name.substring(0,4) + '...';\r\n                }\r\n            }\r\n            else if('SSP_SERVER_TYPE' === gameType){\r\n                name = cc.vv.sspNetMgr.seats[i].name;\r\n                var len = name.length;\r\n                if (len > 4) {\r\n                    name = name.substring(0,4) + '...';\r\n                }\r\n            }\r\n            if(b){\r\n                this._extraInfo += \"\\n[已同意] \"+ name;\r\n            }\r\n            else{\r\n                this._extraInfo += \"\\n[待确认] \"+ name;\r\n            }\r\n        }\r\n        this.closeAll();\r\n        this._popuproot.active = true;\r\n        this._dissolveNotice.active = true;;\r\n    },\r\n    \r\n    // called every frame, uncomment this function to activate update callback\r\n    update: function (dt) {\r\n        if(this._endTime > 0){\r\n            var lastTime = this._endTime - Date.now() / 1000;\r\n            if(lastTime < 0){\r\n                this._endTime = -1;\r\n                // var gameType = cc.vv.userMgr.serverType;\r\n                // if('SSS_SERVER_TYPE' === gameType){\r\n                //     cc.vv.sssNet.send(\"dispress\");\r\n                // }\r\n            }\r\n            \r\n            var m = Math.floor(lastTime / 60);\r\n            var s = Math.ceil(lastTime - m*60);\r\n            \r\n            var str = \"\";\r\n            if(m > 0){\r\n                str += m + \"分\"; \r\n            }\r\n            \r\n            this._noticeLabel.string = str + s + \"秒后房间将自动解散\";\r\n        }\r\n        this._noticePlayerLabel.string = this._extraInfo + \"\\n  \";\r\n    },\r\n});\r\n"]}