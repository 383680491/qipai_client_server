{"version":3,"sources":["History.js"],"names":["Buffer","require","cc","Class","extends","Component","properties","HistoryItemPrefab","default","type","Prefab","_history","_viewlist","_content","_viewitemTemp","_historyData","_curRoomInfo","_emptyTip","_gameType","onLoad","node","getChildByName","active","find","children","removeChild","addClickEvent","target","component","handler","eventHandler","EventHandler","clickEvents","getComponent","Button","push","onBtnBackClicked","initRoomHistoryList","onBtnHistoryClicked","self","vv","userMgr","getHistoryList","data","sort","a","b","time","i","length","id","len","j","s","seats","name","toString","dateFormat","date","Date","dateday","datetime","year","getFullYear","month","getMonth","day","getDate","h","getHours","m","getMinutes","getSeconds","format","getViewItem","planLen","idx","titleId","Label","string","btnOp","info","str","substring","infoScore","score","shrinkContent","initSSPGameHistoryList","roomInfo","create_time","result","JSON","parse","index","content","childrenCount","instantiate","addChild","num","lastOne","getGameListOfRoom","getSSPGamesOfRoom","uuid","getSSPDetailOfGame","roomUUID","base_info","action_records","sspNetMgr","prepareReplay","replayMgr","init","gamestate","numOfMJ","numOfGames","maxNumOfGames","director","loadScene","onViewItemClicked","event","console","log","onBtnOpClicked","parent"],"mappings":"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","file":"History.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["\r\nconst Buffer = require('buffer').Buffer;\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        HistoryItemPrefab:{\r\n            default:null,\r\n            type:cc.Prefab,\r\n        },\r\n        // foo: {\r\n        //    default: null,\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        _history:null,\r\n        _viewlist:null,\r\n        _content:null,\r\n        _viewitemTemp:null,\r\n        _historyData:null,\r\n        _curRoomInfo:null,\r\n        _emptyTip:null,\r\n        _gameType:null,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this._history = this.node.getChildByName(\"history\");\r\n        this._history.active = false;\r\n        \r\n        this._emptyTip = this._history.getChildByName(\"emptyTip\");\r\n        this._emptyTip.active = true;\r\n        \r\n        this._viewlist = this._history.getChildByName(\"viewlist\");\r\n        this._content = cc.find(\"view/content\",this._viewlist);\r\n        \r\n        this._viewitemTemp = this._content.children[0];\r\n        this._content.removeChild(this._viewitemTemp);\r\n\r\n        var node = cc.find(\"Canvas/bottom_center/btn_zhanji\");        \r\n        this.addClickEvent(node,this.node,\"History\",\"onBtnHistoryClicked\");\r\n        \r\n        var node = cc.find(\"Canvas/history/btn_back\");  \r\n        this.addClickEvent(node,this.node,\"History\",\"onBtnBackClicked\");\r\n    },\r\n    \r\n    addClickEvent:function(node,target,component,handler){\r\n        var eventHandler = new cc.Component.EventHandler();\r\n        eventHandler.target = target;\r\n        eventHandler.component = component;\r\n        eventHandler.handler = handler;\r\n\r\n        var clickEvents = node.getComponent(cc.Button).clickEvents;\r\n        clickEvents.push(eventHandler);\r\n    },\r\n    \r\n    onBtnBackClicked:function(){\r\n        if(this._curRoomInfo == null){\r\n            this._historyData = null;\r\n            this._history.active = false;            \r\n        }\r\n        else{\r\n            this.initRoomHistoryList(this._historyData);   \r\n        }\r\n    },\r\n    \r\n    onBtnHistoryClicked:function(){\r\n        this._history.active = true;\r\n        var self = this;\r\n        cc.vv.userMgr.getHistoryList(function(data){\r\n            data.sort(function(a,b){\r\n                return a.time < b.time; \r\n            });\r\n            self._historyData = data;\r\n            for(var i = 0; i < data.length; ++i){\r\n\r\n                if(data[i].id <= 299999 && data[i].id > 199999){ //十三水\r\n                    var len = 6;\r\n                } \r\n                else if(data[i].id <= 399999 && data[i].id > 299999){ //四色牌\r\n                    var len = 4;\r\n                }\r\n\r\n                for(var j = 0; j < len; ++j){\r\n                    var s = data[i].seats[j];\r\n                    s.name = new Buffer(s.name,'base64').toString();\r\n                }\r\n            }\r\n            self.initRoomHistoryList(data);\r\n        });\r\n    },\r\n    \r\n    dateFormat:function(time){\r\n        var date = new Date(time);\r\n        var dateday = \"{0}-{1}-{2}\";\r\n        var datetime = \"{0}:{1}:{2}\";\r\n        var year = date.getFullYear();\r\n        var month = date.getMonth() + 1;\r\n        month = month >= 10? month : (\"0\"+month);\r\n        var day = date.getDate();\r\n        day = day >= 10? day : (\"0\"+day);\r\n        var h = date.getHours();\r\n        h = h >= 10? h : (\"0\"+h);\r\n        var m = date.getMinutes();\r\n        m = m >= 10? m : (\"0\"+m);\r\n        var s = date.getSeconds();\r\n        s = s >= 10? s : (\"0\"+s);\r\n        dateday = dateday.format(year,month,day);\r\n        datetime = datetime.format(h,m,s);\r\n        var date = [];\r\n        date.push(dateday);\r\n        date.push(datetime);\r\n        return date;\r\n    },\r\n    \r\n    initRoomHistoryList:function(data){\r\n        for(var i = 0; i < data.length; ++i){\r\n            var node = this.getViewItem(i);\r\n            var planLen = 0;\r\n            node.idx = i;\r\n            var titleId = \"\" + (i + 1);\r\n            //node.getChildByName(\"title\").getComponent(cc.Label).string = titleId;\r\n            node.getChildByName(\"roomNo\").getComponent(cc.Label).string = data[i].id;\r\n            if(data[i].id <= 299999 && data[i].id > 199999){ //十三水\r\n                node.getChildByName(\"game\").getComponent(cc.Label).string = \"十三水\";\r\n                planLen = 6;\r\n            }\r\n            else if(data[i].id <= 399999 && data[i].id > 299999){ //四色牌\r\n                node.getChildByName(\"game\").getComponent(cc.Label).string = \"四色牌\";\r\n                planLen = 4;\r\n            }\r\n            var datetime = this.dateFormat(data[i].time * 1000)[1];\r\n            var dateday = this.dateFormat(data[i].time * 1000)[0];\r\n            node.getChildByName(\"day\").getComponent(cc.Label).string = dateday;\r\n            node.getChildByName(\"time\").getComponent(cc.Label).string = datetime;\r\n            \r\n            var btnOp = node.getChildByName(\"btnOp\");\r\n            btnOp.idx = i;\r\n            //btnOp.getChildByName(\"Label\").getComponent(cc.Label).string = \"详情\";\r\n            \r\n            for(var j = 0; j < planLen; ++j){\r\n                var s = data[i].seats[j];\r\n                var info = s.name;\r\n                var len = info.length;\r\n                if(len > 2){\r\n                    var str = info.substring(0,2);\r\n                    node.getChildByName(\"info\" + j).getComponent(cc.Label).string = str+\"...\";\r\n                }\r\n                else{\r\n                    node.getChildByName(\"info\" + j).getComponent(cc.Label).string = info;\r\n                }\r\n            }\r\n            for(var j = 0; j < planLen; ++j){\r\n                var s = data[i].seats[j];\r\n                var infoScore = s.score;\r\n                if(s.name == \"\"){\r\n                    infoScore = \"\";\r\n                }\r\n                //console.log(info);\r\n                node.getChildByName(\"infoScore\" + j).getComponent(cc.Label).string = infoScore;\r\n            }\r\n            if(data[i].id <= 399999 && data[i].id > 299999){ //四色牌第5人第6人为空\r\n                node.getChildByName(\"infoScore\" + 4).getComponent(cc.Label).string = \"\";\r\n                node.getChildByName(\"info\" + 4).getComponent(cc.Label).string = \"\";\r\n                node.getChildByName(\"infoScore\" + 5).getComponent(cc.Label).string = \"\";\r\n                node.getChildByName(\"info\" + 5).getComponent(cc.Label).string = \"\";\r\n            }\r\n        }\r\n        this._emptyTip.active = data.length == 0;\r\n        this.shrinkContent(data.length);\r\n        this._curRoomInfo = null;\r\n    },\r\n\r\n    initSSPGameHistoryList:function(roomInfo,data){\r\n        data.sort(function(a,b){\r\n           return a.create_time < b.create_time; \r\n        });\r\n        for(var i = 0; i < data.length; ++i){\r\n            var node = this.getViewItem(i);\r\n            var idx = data.length - i - 1;\r\n            node.idx = idx;\r\n            var titleId = \"\" + (idx + 1);\r\n            node.getChildByName(\"roomNo\").getComponent(cc.Label).string = roomInfo.id;\r\n            node.getChildByName(\"game\").getComponent(cc.Label).string = \"四色牌\";\r\n            var datetime = this.dateFormat(data[i].create_time * 1000)[1];\r\n            var dateday = this.dateFormat(data[i].create_time * 1000)[0];\r\n            node.getChildByName(\"day\").getComponent(cc.Label).string = dateday;\r\n            node.getChildByName(\"time\").getComponent(cc.Label).string = datetime;\r\n            \r\n            var btnOp = node.getChildByName(\"btnOp\");\r\n            btnOp.idx = idx; \r\n            \r\n            var result = JSON.parse(data[i].result);\r\n            for(var j = 0; j < 4; ++j){\r\n                var s = roomInfo.seats[j];\r\n                var info = s.name ;\r\n                var len = info.length;\r\n                if(len > 2){\r\n                    var str = info.substring(0,2);\r\n                    node.getChildByName(\"info\" + j).getComponent(cc.Label).string = str+\"...\";\r\n                }\r\n                else{\r\n                    node.getChildByName(\"info\" + j).getComponent(cc.Label).string = info;\r\n                }\r\n            }\r\n            for(var j = 0; j < 4; ++j){\r\n                var s = roomInfo.seats[j];\r\n                if(s.name === \"\") {\r\n                    node.getChildByName(\"infoScore\" + j).getComponent(cc.Label).string = \"\";\r\n                    node.getChildByName(\"info\" + j).getComponent(cc.Label).string = \"\";\r\n                    continue;\r\n                }\r\n                var infoScore = result[j];\r\n                if(!infoScore){\r\n                    var infoScore = 0 ;\r\n                }\r\n                //console.log(info);\r\n                node.getChildByName(\"infoScore\" + j).getComponent(cc.Label).string = infoScore;\r\n            }\r\n            if(roomInfo.id <= 399999 && roomInfo.id > 299999){ //四色牌第5人第6人为空\r\n                node.getChildByName(\"infoScore\" + 4).getComponent(cc.Label).string = \"\";\r\n                node.getChildByName(\"info\" + 4).getComponent(cc.Label).string = \"\";\r\n                node.getChildByName(\"infoScore\" + 5).getComponent(cc.Label).string = \"\";\r\n                node.getChildByName(\"info\" + 5).getComponent(cc.Label).string = \"\";\r\n            }\r\n        }\r\n        this.shrinkContent(data.length);\r\n        this._curRoomInfo = roomInfo;\r\n    },\r\n    \r\n    getViewItem:function(index){\r\n        var content = this._content;\r\n        if(content.childrenCount > index){\r\n            return content.children[index];\r\n        }\r\n        var node = cc.instantiate(this._viewitemTemp);\r\n        content.addChild(node);\r\n        return node;\r\n    },\r\n    shrinkContent:function(num){\r\n        while(this._content.childrenCount > num){\r\n            var lastOne = this._content.children[this._content.childrenCount -1];\r\n            this._content.removeChild(lastOne,true);\r\n        }\r\n    },\r\n    \r\n    getGameListOfRoom:function(idx){\r\n        var self = this;\r\n        var roomInfo = this._historyData[idx];        \r\n        cc.vv.userMgr.getSSPGamesOfRoom(roomInfo.uuid,function(data){\r\n            if(data != null && data.length > 0 && roomInfo.id > 299999 && roomInfo.id <= 399999){//四色牌\r\n                self.initSSPGameHistoryList(roomInfo,data);\r\n                self._gameType = 3;\r\n            }\r\n        });\r\n    },\r\n\r\n    getSSPDetailOfGame:function(idx){\r\n        var self = this;\r\n        var roomUUID = this._curRoomInfo.uuid;\r\n        cc.vv.userMgr.getSSPDetailOfGame(roomUUID,idx,function(data){\r\n            data.base_info = JSON.parse(data.base_info);\r\n            data.action_records = JSON.parse(data.action_records);\r\n\r\n            // var PlaneLen = 0;//游戏人数\r\n            // for(var i = 0; i < self._curRoomInfo.seats.length; ++i){\r\n            //     if(self._curRoomInfo.seats[i].userid > 0){\r\n            //         PlaneLen++;\r\n            //     }\r\n            // }\r\n            // if(data.base_info.game_seats[PlaneLen-1] === null && cc.vv.userMgr.userId === self._curRoomInfo.seats[PlaneLen-1].userid){ //如果是观察者 看不了回放\r\n            //     return;\r\n            // }\r\n\r\n            cc.vv.sspNetMgr.prepareReplay(self._curRoomInfo,data);\r\n            cc.vv.replayMgr.init(data);\r\n            cc.vv.sspNetMgr.gamestate = 'replay';\r\n            cc.vv.sspNetMgr.numOfMJ = 0;\r\n            cc.vv.sspNetMgr.numOfGames = 0;\r\n            cc.vv.sspNetMgr.maxNumOfGames = 0;\r\n            cc.director.loadScene(\"sspgame\"); \r\n        });\r\n    },\r\n    \r\n    onViewItemClicked:function(event){\r\n        var idx = event.target.idx;\r\n        console.log(idx);\r\n        var roomInfo = this._historyData[idx];\r\n        if(this._curRoomInfo == null){\r\n            this.getGameListOfRoom(idx);\r\n        }\r\n        else if(this._gameType === 3){//四色牌\r\n            this.getSSPDetailOfGame(idx);\r\n        }\r\n    },\r\n    \r\n    onBtnOpClicked:function(event){\r\n        var idx = event.target.parent.idx;\r\n        console.log(idx);\r\n        var roomInfo = this._historyData[idx];\r\n        if(this._curRoomInfo == null){\r\n            this._gameType = 0;\r\n            this.getGameListOfRoom(idx);\r\n        }\r\n        else if(this._gameType === 3){//四色牌\r\n            this.getSSPDetailOfGame(idx);\r\n        }\r\n    },\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}