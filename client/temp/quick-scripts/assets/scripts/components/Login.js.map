{"version":3,"sources":["Login.js"],"names":["String","prototype","format","args","arguments","length","result","key","reg","RegExp","replace","i","undefined","cc","Class","extends","Component","properties","_mima","_mimaIndex","onLoad","sys","isNative","isMobile","cvs","node","getComponent","Canvas","fitHeight","fitWidth","vv","director","loadScene","http","url","master_url","net","addHandler","console","log","audioMgr","playBGM","find","active","jquery","window","jQuery","APPID","SECRET","NETAPPID","NETSECRET","browserType","H5_WXGetToken","os","OS_ANDROID","OS_IOS","start","account","localStorage","getItem","sign","ret","errcode","userMgr","onAuth","self","onGet","errmsg","data","type","version","sendRequest","bind","onBtnQuickStartClicked","guestAuth","onBtnWeichatClicked","H5_WXGetCode","location","href","agent","anysdk","agentManager","user_plugin","getUserPlugin","login","setListener","WeiChatCallBack","szCode","GetQueryString","wxUrl","ajax","cache","success","Data","Json_Data","JSON","parse","szAccess_token","access_token","szRfresh_token","refresh_token","szOpenid","openid","GetUserInfo","error","GetAccess_token","setItem","nickname","sex","headimgurl","userData","unionid","anysdkMgr","onLoginResp","name","r","search","substr","match","unescape","code","msg","UserActionResultCode","kLoginSuccess","uid","getUserID","info","getUserInfo","nickName","avatarUrl","kLoginNetworkError","kLoginCancel","kLoginFail","onBtnMIMAClicked","event","target"],"mappings":"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","file":"Login.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\components","sourcesContent":["String.prototype.format = function(args) { \r\n    if (arguments.length>0) { \r\n        var result = this; \r\n        if (arguments.length == 1 && typeof (args) == \"object\") { \r\n            for (var key in args) { \r\n                var reg=new RegExp (\"({\"+key+\"})\",\"g\"); \r\n                result = result.replace(reg, args[key]); \r\n            } \r\n        } \r\n        else { \r\n            for (var i = 0; i < arguments.length; i++) { \r\n                if(arguments[i]==undefined) { \r\n                    return \"\"; \r\n                } \r\n                else { \r\n                    var reg=new RegExp (\"({[\"+i+\"]})\",\"g\"); \r\n                    result = result.replace(reg, arguments[i]); \r\n                } \r\n            } \r\n        } \r\n        return result; \r\n    } \r\n    else { \r\n        return this; \r\n    } \r\n};\r\n\r\n//<script src=\"jquery.js\"></script>\r\n//<script src=\"https://code.jquery.com/jquery-3.2.1.min.js \"></script>\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n        _mima:null,\r\n        _mimaIndex:0,\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        if(!cc.sys.isNative && cc.sys.isMobile){\r\n            var cvs = this.node.getComponent(cc.Canvas);\r\n            cvs.fitHeight = true;\r\n            cvs.fitWidth = true;\r\n        }\r\n        \r\n        if(!cc.vv){\r\n            cc.director.loadScene(\"loading\");\r\n            return;\r\n        }\r\n        cc.vv.http.url = cc.vv.http.master_url;\r\n        cc.vv.net.addHandler('push_need_create_role',function(){\r\n            console.log(\"onLoad:push_need_create_role\");\r\n            cc.director.loadScene(\"createrole\");\r\n        });\r\n        \r\n        cc.vv.audioMgr.playBGM(\"bgMain.mp3\");\r\n        \r\n        this._mima = [\"A\",\"A\",\"B\",\"B\",\"A\",\"B\",\"A\",\"B\",\"A\",\"A\",\"A\",\"B\",\"B\",\"B\"];\r\n        \r\n        // if(!cc.sys.isNative || cc.sys.os == cc.sys.OS_WINDOWS){\r\n        //     cc.find(\"Canvas/btn_yk\").active = true;\r\n        //     cc.find(\"Canvas/btn_weixin\").active = true;\r\n        // }\r\n        // else{\r\n        //     cc.find(\"Canvas/btn_yk\").active = true;\r\n        //     cc.find(\"Canvas/btn_weixin\").active = true;\r\n        // }\r\n        cc.find(\"Canvas/btn_yk\").active = false;\r\n        cc.find(\"Canvas/btn_weixin\").active = false;\r\n\r\n        this.jquery = window.jQuery;\r\n        //公众号appid\r\n        this.APPID = \"wxc79611510593f0ca\";\r\n        this.SECRET = \"897da32742b97e684d6fe1d78dac03ee\";\r\n\r\n        //网站appid\r\n        this.NETAPPID = \"wx7f3748cc28cd072c\";\r\n        this.NETSECRET = \"4fc49e95d9e8cabfa749429fcda31974\";\r\n\r\n        \r\n        //微信浏览器----公众号登录 \r\n        if(cc.sys.browserType == \"mqqbrowser\" || \"wechat\" == cc.sys.browserType){\r\n            this.H5_WXGetToken();\r\n        }\r\n        else if(cc.sys.os == cc.sys.OS_ANDROID || cc.sys.os == cc.sys.OS_IOS){\r\n            \r\n        }\r\n        //其它浏览器----二维码扫码登录 \r\n        else{\r\n            this.H5_WXGetToken();\r\n        }\r\n    },\r\n    \r\n    start:function(){\r\n        var account =  cc.sys.localStorage.getItem(\"wx_account\");\r\n        var sign = cc.sys.localStorage.getItem(\"wx_sign\");\r\n        if(account != null && sign != null){\r\n            var ret = {\r\n                errcode:0,\r\n                account:account,\r\n                sign:sign\r\n            }\r\n            cc.vv.userMgr.onAuth(ret);\r\n        }\r\n\r\n        //控制是否显示微信登录\r\n        var self = this;\r\n        var onGet = function(ret){\r\n            if(ret.errcode !== 0){\r\n                console.log(ret.errmsg);\r\n            }\r\n            else{\r\n                cc.find(\"Canvas/btn_yk\").active = true;\r\n                cc.find(\"Canvas/btn_weixin\").active = true;\r\n            }\r\n        };\r\n            \r\n        var data = {\r\n            account:cc.vv.userMgr.account,\r\n            sign:cc.vv.userMgr.sign,\r\n            type:\"control\",\r\n            version:20161128\r\n        };\r\n        cc.vv.http.sendRequest(\"/get_message\",data,onGet.bind(this));\r\n    },\r\n    \r\n    onBtnQuickStartClicked:function(){\r\n        cc.vv.userMgr.guestAuth();\r\n        // var self = this;\r\n        // if(!self.user_plugin)\r\n        // {\r\n        //     return;\r\n        // }\r\n        // self.user_plugin.login();\r\n    },\r\n    \r\n    onBtnWeichatClicked:function(){\r\n        // console.log(\"onBtnWeichatClicked\");\r\n        this.H5_WXGetCode();\r\n    },\r\n    H5_WXGetCode:function(){\r\n        \r\n        //微信浏览器----公众号登录 \r\n        if(cc.sys.browserType == \"mqqbrowser\" || \"wechat\" == cc.sys.browserType){\r\n            console.log(\"cc.sys.browserType == mqqbrowser || wechat == cc.sys.browserType\");\r\n            window.location.href = \"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxc79611510593f0ca&redirect_uri=http://game.doudouyule.wang&response_type=code&scope=snsapi_userinfo&state=111#wechat_redirect\";\r\n            //window.location.href = \"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wxc79611510593f0ca&redirect_uri=game.doudouyule.wang&response_type=code&scope=snsapi_userinfo&state=111#wechat_redirect\";\r\n        }\r\n        else if(cc.sys.os == cc.sys.OS_ANDROID || cc.sys.os == cc.sys.OS_IOS){\r\n            console.log(\"cc.sys.platform == cc.sys.OS_ANDROID || cc.sys.platform == cc.sys.OS_IOS\");\r\n            var agent = anysdk.agentManager;\r\n            this.user_plugin = agent.getUserPlugin();\r\n            console.log(\"user_plugin:\"+this.user_plugin);\r\n\r\n            if(!this.user_plugin) return;\r\n            this.user_plugin.login();\r\n            this.user_plugin.setListener(this.WeiChatCallBack, this);\r\n        }\r\n        //其它浏览器----二维码扫码登录 \r\n        else{\r\n            console.log(\"其它浏览器----二维码扫码登录\");\r\n            window.location.href = \"https://open.weixin.qq.com/connect/qrconnect?appid=wx7f3748cc28cd072c&redirect_uri=http://game.doudouyule.wang&response_type=code&scope=snsapi_login&state=111#wechat_redirect\";\r\n        }\r\n    },\r\n\r\n    H5_WXGetToken:function(){\r\n        console.log('H5_WXGetToken');\r\n        var self = this;\r\n        var szCode = self.GetQueryString(\"code\");\r\n        console.log('szCode:'+szCode);\r\n        //cc.find(\"Canvas/btn_weiCxin\").active = false;\r\n        //微信浏览器----公众号登录\r\n        if(cc.sys.browserType == \"mqqbrowser\" || \"wechat\" == cc.sys.browserType){\r\n            console.log(\"cc.sys.browserType == mqqbrowser || wechat == cc.sys.browserType\");\r\n            var APPID = \"wxc79611510593f0ca\";\r\n            var SECRET = \"897da32742b97e684d6fe1d78dac03ee\";\r\n        }\r\n        //其它浏览器----二维码扫码登录 \r\n        else{\r\n            console.log(\"其它浏览器----二维码扫码登录\");\r\n            var APPID = \"wx7f3748cc28cd072c\";\r\n            var SECRET = \"4fc49e95d9e8cabfa749429fcda31974\";\r\n        }\r\n        if(szCode != null && szCode.length > 2){\r\n            var wxUrl = \"http://game.doudouyule.wang/login.php?code=\"+szCode+\"&APPID=\"+APPID+\"&SECRET=\"+SECRET;\r\n            console.log(\"wxUrl:\"+wxUrl);\r\n            this.jquery.ajax({\r\n                type:\"POST\",\r\n                url:wxUrl,\r\n                cache:false,\r\n                //data:\"appid\"+self.APPID+\"&appsecret=\"+self.SECRET+\"&code=\"+szCode,\r\n                success:function(Data){\r\n                    console.log('H5_WXGetToken success:'+Data);\r\n                    var Json_Data = JSON.parse(Data);\r\n                    var errmsg = Json_Data.errmsg;\r\n                    if(errmsg == undefined){\r\n                        var szAccess_token = Json_Data.access_token;\r\n                        var szRfresh_token = Json_Data.refresh_token;\r\n                        var szOpenid = Json_Data.openid;\r\n                        console.log('szAccess_token:'+szAccess_token);\r\n                        console.log('szRfresh_token:'+szRfresh_token);\r\n                        console.log('szOpenid:'+szOpenid);\r\n                        self.GetUserInfo(szAccess_token,szRfresh_token,szOpenid)\r\n                    }\r\n                    else{\r\n                        console.log('errmsg != undefined');\r\n                        cc.find(\"Canvas/btn_weixin\").active = true;\r\n                    }\r\n                },\r\n                error:function(data){\r\n                    console.log('error');\r\n                    console.log(data);\r\n                }\r\n            });\r\n        }\r\n        else{\r\n            cc.find(\"Canvas/btn_weixin\").active = true;\r\n        }\r\n    },\r\n\r\n    GetAccess_token:function(){\r\n        console.log(\"000000\");\r\n    },\r\n\r\n    GetUserInfo:function(access_token,refresh_token,openid){\r\n        console.log('GetUserInfo');\r\n        var self = this;\r\n        //保存rfresh_token\r\n        cc.sys.localStorage.setItem(\"H5_wxrefreshToken\",refresh_token);\r\n        cc.sys.localStorage.setItem(\"H5_wxaccess_token\",access_token);\r\n        \r\n        var wxUrl =  \"http://game.doudouyule.wang/getUserInfo.php?access_token=\"+access_token+\"&openid=\"+openid;\r\n        console.log(\"wxUrl#####\"+wxUrl);\r\n        this.jquery.ajax({\r\n            type:\"POST\",\r\n            url:wxUrl,\r\n            cache:false,\r\n            success:function(Data){\r\n                console.log(\"@@@@@@@@@@@@@@@@@\");\r\n                console.log(Data);\r\n                var Json_Data = JSON.parse(Data);\r\n                console.log(Json_Data);\r\n                \r\n                var errmsg = Json_Data.errmsg;\r\n                if(errmsg == undefined){\r\n                    console.log(\"openid\" + Json_Data.openid);\r\n                    console.log(\"nickname\" + Json_Data.nickname);\r\n                    console.log(\"sex\" + Json_Data.sex);\r\n                    console.log(\"headimgurl\" + Json_Data.headimgurl);\r\n                    var userData = {\r\n                        unionid:Json_Data.unionid,\r\n                        openid:Json_Data.openid,\r\n                        nickname:Json_Data.nickname,\r\n                        sex:Json_Data.sex,\r\n                        headimgurl:Json_Data.headimgurl\r\n                    }\r\n                    cc.vv.anysdkMgr.onLoginResp(userData);\r\n                    //self.GetQueryString(Json_Data);\r\n                }\r\n            },\r\n            error:function(data){\r\n                console.log(data);\r\n            }\r\n        });\r\n    },\r\n\r\n    GetQueryString:function(name){\r\n        console.log('GetQueryString');\r\n        console.log('name:'+name);\r\n\r\n        var reg = new RegExp(\"(^|&)\"+ name +\"=([^&]*)(&|$)\");\r\n        var r = window.location.search.substr(1).match(reg);\r\n        if(r!=null)\r\n            return  unescape(r[2]); \r\n        return null;\r\n    },\r\n\r\n    WeiChatCallBack:function(code,msg){\r\n        console.log(\"WeiChatCallBack\");\r\n        var self = this;\r\n        console.log('11111111111111');\r\n        console.log('code: ' + code);\r\n        console.log('msg' + msg);\r\n        console.log('11111111111111');\r\n        switch(code)\r\n        {\r\n        case anysdk.UserActionResultCode.kLoginSuccess: //登陆成功回调\r\n            //登陆成功后，游戏相关处理\r\n            console.log(\"kLoginSuccess\");\r\n            var uid = this.user_plugin.getUserID();\r\n            var info = JSON.parse(this.user_plugin.getUserInfo());\r\n\r\n            var data = {\r\n                openid:uid,\r\n                nickname:info.nickName,\r\n                sex:info.sex,\r\n                headimgurl:info.avatarUrl,\r\n                unionid:info.unionid,\r\n            }\r\n            console.log(\"unionid54545454:\"+data.unionid);\r\n            cc.vv.anysdkMgr.onLoginResp(data);\r\n\r\n            console.log(\"unionid54545454:\"+data.unionid);\r\n\r\n            //cc.vv.userMgr.guestAuth(info[\"unionid\"]);\r\n\r\n            //cc.vv.userMgr.login(info[\"sex\"],info[\"nickName\"],info[\"unionid\"]，info[\"avatarUrl\"]);//性别 名字 ID 头像\r\n            \r\n            //cc.vv.anysdkMgr.onLoginResp(code);\r\n            break;\r\n        case anysdk.UserActionResultCode.kLoginNetworkError: //登陆网络出错回调\r\n            console.log(\"kLoginNetworkError\");\r\n            break;\r\n        case anysdk.UserActionResultCode.kLoginCancel: //登陆取消回调\r\n            console.log(\"kLoginCancel\");\r\n            break;\r\n        case anysdk.UserActionResultCode.kLoginFail: //登陆失败回调\r\n            console.log(\"kLoginFail\");\r\n\r\n            //登陆失败后，游戏相关处理\r\n\r\n            break;\r\n        }\r\n    },\r\n    \r\n    onBtnMIMAClicked:function(event){\r\n        if(this._mima[this._mimaIndex] == event.target.name){\r\n            this._mimaIndex++;\r\n            if(this._mimaIndex == this._mima.length){\r\n                cc.find(\"Canvas/btn_yk\").active = true;\r\n            }\r\n        }\r\n        else{\r\n            console.log(\"oh ho~~~\");\r\n            this._mimaIndex = 0;\r\n        }\r\n    }\r\n\r\n    // called every frame, uncomment this function to activate update callback\r\n    // update: function (dt) {\r\n\r\n    // },\r\n});\r\n"]}