{"version":3,"sources":["seats.js"],"names":["cc","Class","extends","Component","properties","onLoad","seats","seatComs","i","node","children","length","name","seatNode","getChildByName","seatCom","getComponent","push","start","reset","refreshSeats","seatData","vv","sssNetMgr","userid","index","getLocalIndex","seatindex","setInfo","setReady","ready","resetALLSeat","indexClear","emptyChatBubble","_chatBubble","active","_emoji","setPlayerReady","data","resetReady","setAllScoreResult","len","userId","seatIndex","getSeatIndexByID","setTotalScore","allScore","setPlayerInfo","playerData","showPlayerInfo","isChuPai","fapaiAnimate","self","fapaiAnimation","wanfa","animation","window","sssGame","Animation","kaipai","kaimapai","paiAtlas","maPai","Sprite","arrType","paiName","maPaiData","type","value","spriteFrame","getSpriteFrame","play"],"mappings":"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","file":"seats.js","sourceRoot":"..\\..\\..\\..\\..\\assets\\scripts\\sssgame","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // foo: {\r\n        //    default: null,      // The default value will be used only when the component attaching\r\n        //                           to a node for the first time\r\n        //    url: cc.Texture2D,  // optional, default is typeof default\r\n        //    serializable: true, // optional, default is true\r\n        //    visible: true,      // optional, default is true\r\n        //    displayName: 'Foo', // optional\r\n        //    readonly: false,    // optional, default is false\r\n        // },\r\n        // ...\r\n    },\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        this.seats = [];\r\n        this.seatComs = [];\r\n        \r\n        for(var i = 0; i < this.node.children.length; i++){\r\n            var name = 'seat'+i;\r\n            var seatNode = this.node.getChildByName(name);\r\n            var seatCom = seatNode.getComponent('sss_seat');\r\n            this.seats.push(seatNode);\r\n            this.seatComs.push(seatCom);\r\n        }\r\n    },\r\n\r\n    start:function(){\r\n        this.reset();\r\n    },\r\n\r\n    refreshSeats:function(){\r\n        var seatData = cc.vv.sssNetMgr.seats;\r\n        for (var i = 0; i < seatData.length; i++) {\r\n            if(seatData[i].userid <= 0){\r\n                continue;\r\n            }\r\n            var index = cc.vv.sssNetMgr.getLocalIndex(seatData[i].seatindex);\r\n            this.seatComs[index].setInfo(seatData[i]);\r\n            this.seatComs[index].setReady(seatData[i].ready);\r\n        }\r\n    },\r\n\r\n    resetALLSeat:function() {\r\n        var seatData = cc.vv.sssNetMgr.seats;\r\n        for (var i = 0; i < seatData.length; i++) {\r\n            if(seatData[i].userid <= 0){\r\n                var indexClear = cc.vv.sssNetMgr.getLocalIndex(seatData[i].seatindex);\r\n                this.seatComs[indexClear].setInfo(seatData[i]);\r\n                this.seatComs[index].setReady(false);\r\n                continue;\r\n            }\r\n            var index = cc.vv.sssNetMgr.getLocalIndex(seatData[i].seatindex);\r\n            this.seatComs[index].setInfo(seatData[i]);\r\n            this.seatComs[index].setReady(seatData[i].ready);\r\n        }\r\n    },\r\n\r\n    emptyChatBubble:function() {//清空聊天\r\n        var seatData = cc.vv.sssNetMgr.seats;\r\n        for (var i = 0; i < this.seatComs.length; i++) {\r\n            this.seatComs[i]._chatBubble.active = false; \r\n            this.seatComs[i]._emoji.active = false; \r\n        }\r\n    },\r\n    \r\n    setPlayerReady:function(data) {\r\n        var userid = data;\r\n        var seatData = cc.vv.sssNetMgr.seats;\r\n        for (var i = 0; i < seatData.length; i++) {\r\n            if(seatData[i].userid === userid){\r\n                var index = cc.vv.sssNetMgr.getLocalIndex(seatData[i].seatindex);\r\n                this.seatComs[index].setReady(seatData[i].ready);\r\n            }\r\n        }\r\n    },\r\n\r\n    resetReady:function() {\r\n        var seatData = cc.vv.sssNetMgr.seats;\r\n        for (var i = 0; i < seatData.length; i++) {\r\n            if(seatData[i].userid <= 0){\r\n                continue;\r\n            }\r\n            this.seatComs[i].setReady(false);\r\n        }\r\n    },\r\n\r\n    setAllScoreResult:function(data) {\r\n        var len = data.length;\r\n        for (let i = 0; i < len; i++) {\r\n            var userId = data[i].userId;\r\n            var seatIndex = cc.vv.sssNetMgr.getSeatIndexByID(userId);\r\n            var index = cc.vv.sssNetMgr.getLocalIndex(seatIndex);\r\n            if(!this.seatComs[index]){\r\n                return;\r\n            }\r\n            this.seatComs[index].setTotalScore(data[i].allScore);\r\n        }\r\n    },\r\n    \r\n    reset:function(){\r\n        for(let i = 0;i<this.seatComs.length;i++){\r\n            this.seatComs[i].reset();\r\n        }\r\n    },\r\n\r\n    setPlayerInfo:function(data){\r\n        var playerData = data;\r\n        for(let i = 0; i<playerData.length;i++){\r\n            var seatIndex = cc.vv.sssNetMgr.getSeatIndexByID(playerData[i].userId);\r\n            var index = cc.vv.sssNetMgr.getLocalIndex(seatIndex);\r\n            if(!this.seatComs[index]){\r\n                return;\r\n            }\r\n            this.seatComs[index].showPlayerInfo(playerData[i].isChuPai);\r\n        }\r\n    },\r\n\r\n    fapaiAnimate:function(){\r\n        var seats = cc.vv.sssNetMgr.seats;\r\n        var self = this;\r\n        for(let i = 0;i<seats.length;i++){\r\n            if(seats[i].userid > 0){\r\n                var index = cc.vv.sssNetMgr.getLocalIndex(i);\r\n                self.seatComs[index].fapaiAnimation(index);\r\n            }\r\n        }\r\n        if(cc.vv.sssNetMgr.wanfa === 3){  //百变或马牌\r\n            var animation = window.sssGame.Animation;\r\n            var kaipai = animation.kaipai;\r\n            var kaimapai = animation.kaimapai;\r\n            var paiAtlas = window.sssGame.paiAtlas;\r\n            var maPai = kaimapai.getChildByName('paibei').getChildByName('jiedian').getComponent(cc.Sprite);\r\n\r\n            var arrType = [\"hua\",\"tao\",\"xin\",\"fangkuai\"];\r\n            var paiName = arrType[cc.vv.sssNetMgr.maPaiData.type] + cc.vv.sssNetMgr.maPaiData.value;\r\n            var spriteFrame = paiAtlas.getSpriteFrame(paiName);\r\n            maPai.spriteFrame = spriteFrame;\r\n            kaimapai.active = true;\r\n            kaimapai.getComponent(cc.Animation).play('kaimapai');\r\n        }\r\n    },\r\n\r\n});\r\n"]}