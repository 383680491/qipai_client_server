{"version":3,"sources":["UserMgr.js"],"names":["cc","Class","extends","Component","properties","account","userId","userName","lv","exp","coins","gems","sign","ip","sex","roomData","oldRoomId","bObserver","guestAuth","args","sys","localStorage","getItem","Date","now","setItem","vv","http","sendRequest","onAuth","ret","self","userMgr","errcode","console","log","errmsg","url","SI","hall","login","onLogin","userid","director","loadScene","name","roomid","isAnalytics","cocosAnalytics","CAAccount","loginStart","loginSuccess","setGender","wc","show","create","onCreate","data","enterRoom","roomId","callback","serverType","getServerTypeByRid","onEnter","setTimeout","hide","sssNetMgr","connectGameServer","sspNetMgr","isObserver","getHistoryList","onGet","history","getSSPGamesOfRoom","uuid","getSSPDetailOfGame","index","rid"],"mappings":"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","file":"UserMgr.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n    properties: {\r\n        account:null,\r\n\t    userId:null,\r\n\t\tuserName:null,\r\n\t\tlv:0,\r\n\t\texp:0,\r\n\t\tcoins:0,\r\n\t\tgems:0,\r\n\t\tsign:0,\r\n        ip:\"\",\r\n        sex:0,\r\n        roomData:null,\r\n        \r\n        oldRoomId:null,\r\n        bObserver:false,\r\n    },\r\n    \r\n    guestAuth:function(){\r\n        var account = cc.args[\"account\"];\r\n        if(account == null){\r\n            account = cc.sys.localStorage.getItem(\"account\");\r\n        }\r\n        \r\n        if(account == null){\r\n            account = Date.now();\r\n            cc.sys.localStorage.setItem(\"account\",account);\r\n        }\r\n        \r\n        cc.vv.http.sendRequest(\"/guest\",{account:account},this.onAuth);\r\n    },\r\n    \r\n    onAuth:function(ret){\r\n        var self = cc.vv.userMgr;\r\n        if(ret.errcode !== 0){\r\n            console.log(ret.errmsg);\r\n        }\r\n        else{\r\n            self.account = ret.account;\r\n            self.sign = ret.sign;\r\n            cc.vv.http.url = \"http://\" + cc.vv.SI.hall;\r\n            self.login();\r\n        }   \r\n    },\r\n    \r\n    login:function(){\r\n        var self = this;\r\n        var onLogin = function(ret){\r\n            if(ret.errcode !== 0){\r\n                console.log(ret.errmsg);\r\n            }\r\n            else{\r\n                if(!ret.userid){\r\n                    //jump to register user info.\r\n                    cc.director.loadScene(\"createrole\");\r\n                }\r\n                else{\r\n                    console.log(ret);\r\n                    self.account = ret.account;\r\n                    self.userId = ret.userid;\r\n                    self.userName = ret.name;\r\n                    self.lv = ret.lv;\r\n                    self.exp = ret.exp;\r\n                    self.coins = ret.coins;\r\n                    self.gems = ret.gems;\r\n                    self.roomData = ret.roomid;\r\n                    self.sex = ret.sex;\r\n                    self.ip = ret.ip;\r\n                    //打开统计\r\n                    if(cc.vv.isAnalytics){\r\n                        cocosAnalytics.CAAccount.loginStart();\r\n                        cocosAnalytics.CAAccount.loginSuccess(ret.userid);\r\n                        cocosAnalytics.CAAccount.setGender(ret.sex);\r\n                    }\r\n                    cc.director.loadScene(\"hall\");\r\n                }\r\n            }\r\n        };\r\n        cc.vv.wc.show(\"正在登录游戏\");\r\n        cc.vv.http.sendRequest(\"/login\",{account:this.account,sign:this.sign},onLogin);\r\n    },\r\n    \r\n    create:function(name){\r\n        var self = this;\r\n        var onCreate = function(ret){\r\n            console.log('create: ' + ret.errcode);\r\n            \r\n            if(ret.errcode !== 0){\r\n                console.log(ret.errmsg);\r\n            }\r\n            else{\r\n                self.login();\r\n            }\r\n        };\r\n        \r\n        var data = {\r\n            account:this.account,\r\n            sign:this.sign,\r\n            name:name\r\n        };\r\n        cc.vv.http.sendRequest(\"/create_user\",data,onCreate);    \r\n    },\r\n    \r\n    enterRoom:function(roomId,callback){\r\n        var self = this;\r\n        var serverType = this.getServerTypeByRid(roomId);\r\n        var onEnter = function(ret){\r\n            if(ret.errcode !== 0){\r\n                if(ret.errcode == -1){\r\n                    setTimeout(function(){\r\n                        self.enterRoom(roomId,callback);\r\n                    },5000);\r\n                }\r\n                else{\r\n                    cc.vv.wc.hide();\r\n                    if(callback != null){\r\n                        callback(ret);\r\n                    }\r\n                }\r\n            }\r\n            else{\r\n                cc.vv.wc.hide();\r\n                if(callback != null){\r\n                    callback(ret);\r\n                }\r\n                if(serverType == 'SSS_SERVER_TYPE'){\r\n                    cc.vv.sssNetMgr.connectGameServer(ret);\r\n                }\r\n                else if(serverType == 'SSP_SERVER_TYPE'){\r\n                    cc.vv.sspNetMgr.connectGameServer(ret);\r\n                }\r\n            }\r\n        };\r\n        var isObserver = cc.vv.userMgr.bObserver;\r\n        var data = {\r\n            account:cc.vv.userMgr.account,\r\n            sign:cc.vv.userMgr.sign,\r\n            serverType:serverType,\r\n            roomid:roomId,\r\n            isObserver:isObserver\r\n        };\r\n        cc.vv.wc.show(\"正在进入房间 \" + roomId);\r\n        cc.vv.http.sendRequest(\"/enter_private_room\",data,onEnter);\r\n    },\r\n    getHistoryList:function(callback){\r\n        var self = this;\r\n        var onGet = function(ret){\r\n            if(ret.errcode !== 0){\r\n                console.log(ret.errmsg);\r\n            }\r\n            else{\r\n                console.log(ret.history);\r\n                if(callback != null){\r\n                    callback(ret.history);\r\n                }\r\n            }\r\n        };\r\n        \r\n        var data = {\r\n            account:cc.vv.userMgr.account,\r\n            sign:cc.vv.userMgr.sign,\r\n        };\r\n        cc.vv.http.sendRequest(\"/get_history_list\",data,onGet);\r\n    },\r\n    getSSPGamesOfRoom:function(uuid,callback){\r\n        var self = this;\r\n        var onGet = function(ret){\r\n            if(ret.errcode !== 0){\r\n                console.log(ret.errmsg);\r\n            }\r\n            else{\r\n                console.log(ret.data);\r\n                callback(ret.data);\r\n            }\r\n        };\r\n        \r\n        var data = {\r\n            account:cc.vv.userMgr.account,\r\n            sign:cc.vv.userMgr.sign,\r\n            uuid:uuid,\r\n        };\r\n        cc.vv.http.sendRequest(\"/get_SSPgames_of_room\",data,onGet);\r\n    },\r\n    getSSPDetailOfGame:function(uuid,index,callback){ //四色牌\r\n        var self = this;\r\n        var onGet = function(ret){\r\n            if(ret.errcode !== 0){\r\n                console.log(ret.errmsg);\r\n            }\r\n            else{\r\n                console.log(ret.data);\r\n                callback(ret.data);\r\n            }       \r\n        };\r\n        \r\n        var data = {\r\n            account:cc.vv.userMgr.account,\r\n            sign:cc.vv.userMgr.sign,\r\n            uuid:uuid,\r\n            index:index,\r\n        };\r\n        cc.vv.http.sendRequest(\"/get_detail_of_SSPgame\",data,onGet);\r\n    },\r\n    getServerTypeByRid:function(rid){\r\n        if((rid >= 200000)&&(rid < 300000)){\r\n            return \"SSS_SERVER_TYPE\";\r\n        }\r\n        else if((rid >= 300000)&&(rid < 400000)){\r\n            return \"SSP_SERVER_TYPE\";\r\n        }\r\n        else{\r\n            return \"\";\r\n        }\r\n    }\r\n});\r\n"]}